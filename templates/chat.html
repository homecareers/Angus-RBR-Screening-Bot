<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>ANGUSâ„¢ Legacy Code Screening</title>
  <style>
    body{
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif;
      background:#0b0f14;
      color:#e6edf3;
      margin:0; padding:0;
      display:flex; justify-content:center;
    }
    .wrap{ width:100%; max-width:720px; padding:18px;}
    .chat-box{
      background:#0f1621;
      border:1px solid #1f2a3a;
      border-radius:18px;
      padding:16px;
      height:72vh;
      overflow-y:auto;
      box-shadow:0 10px 30px rgba(0,0,0,.35);
    }
    .message{
      max-width:85%;
      padding:10px 12px;
      margin:8px 0;
      border-radius:14px;
      line-height:1.35;
      font-size:16px;
      white-space:pre-wrap;
    }
    .bot{
      background:#151f2e;
      border:1px solid #22324a;
    }
    .user{
      background:#1e7bff;
      color:white;
      margin-left:auto;
      border:1px solid #3a8bff;
    }
    .loading{
      opacity:.7; font-style:italic;
      background:transparent; border:none;
    }
    .options{
      display:flex; flex-wrap:wrap; gap:8px; margin-top:10px;
    }
    .options button{
      background:#121a26;
      border:1px solid #283a55;
      color:#e6edf3;
      padding:10px 12px;
      border-radius:12px;
      cursor:pointer;
      transition:.15s;
      font-size:15px;
    }
    .options button:hover{
      transform:translateY(-1px);
      border-color:#3b82f6;
    }
    input[type="email"]{
      width:100%;
      margin-top:10px;
      padding:12px;
      border-radius:10px;
      border:1px solid #2a3d58;
      background:#0b111a;
      color:#e6edf3;
      font-size:16px;
      outline:none;
    }
    .footer-note{
      text-align:center; margin-top:8px; opacity:.7; font-size:12px;
    }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="chat-box" id="chat"></div>
    <div class="footer-note">Powered by ANGUSâ„¢ â€¢ The Real Brick Roadâ„¢ ðŸ§±</div>
  </div>

  <script>
    const chat = document.getElementById('chat');
    const BACKEND_URL = "/submit"; // <-- Will use relative URL, update if needed

    // ðŸ§± PERFECT 6 (Round 1)
    const surveyFlow = [
      {
        question: "ðŸ”¥ **Q1:** What's the REAL reason you're exploring a new path right now?",
        options: [
          "ðŸ’° Money pressure â€” I need breathing room",
          "ðŸ•Šï¸ I want more freedom + control",
          "ðŸŒªï¸ I'm craving a fresh start",
          "ðŸ˜ I'm not fulfilled where I am",
          "ðŸ—ï¸ I want to build something that actually lasts",
          "âš¡ Not sure â€” something in me just says "it's time""
        ]
      },
      {
        question: "ðŸ§­ **Q2:** Where are you in life/work as you step into this? (tell me in your own words if you want)",
        options: [
          "ðŸ‘” Working full-time",
          "ðŸ¡ Stay-at-home parent",
          "ðŸ”„ Between jobs / rebuilding",
          "ðŸ§ª Running a side hustle",
          "ðŸš€ Running my own business",
          "âœï¸ Other / I'll explain"
        ]
      },
      {
        question: "â³ **Q3:** How much weekly bandwidth can you commit to building your Legacy?",
        options: [
          "3â€“5 hrs",
          "5â€“10 hrs",
          "10â€“20 hrs",
          "20+ hrs",
          "ðŸ”¥ I'll find the time â€” this matters"
        ]
      },
      {
        question: "ðŸ§¨ **Q4:** When you've tried chasing big goals beforeâ€¦ what usually derailed you?",
        options: [
          "ðŸ§± No structure",
          "ðŸ§‘â€ðŸ« No mentor",
          "ðŸ§  Overthinking",
          "ðŸŒŠ Life chaos",
          "ðŸ˜¬ Confidence dips",
          "ðŸªž I've never really pursued a big goal before"
        ]
      },
      {
        question: "ðŸ’Ž **Q5:** What style do you thrive in?",
        options: [
          "ðŸ—ºï¸ Clear structure",
          "âœ… Step-by-step",
          "ðŸŒ¿ Freedom/flexibility",
          "ðŸŽ¯ Accountability",
          "ðŸ¤ Community support",
          "âœï¸ Let me describe it"
        ]
      },
      {
        question: "âš¡ **Q6:** If I map out a personalized 90-day blueprint for youâ€¦ are you ready to follow it?",
        options: [
          "âœ… Yes â€” I'm ready now",
          "ðŸ‘ Yes â€” if the plan feels doable",
          "ðŸ¤” I want to be, but I need clarity first",
          "ðŸ§­ Not sure yet â€” guide me"
        ]
      }
    ];

    let answers = [];
    let step = 0;
    let userEmail = "";

    function showBotMessage(msg){
      chat.innerHTML += `<div class="message bot">${msg}</div>`;
      chat.scrollTop = chat.scrollHeight;
    }

    function showUserMessage(msg){
      chat.innerHTML += `<div class="message user">${msg}</div>`;
      chat.scrollTop = chat.scrollHeight;
    }

    function showLoading(){
      chat.innerHTML += `<div class="message loading" id="loading">ANGUS is thinkingâ€¦ ðŸ§ âš¡</div>`;
      chat.scrollTop = chat.scrollHeight;
    }

    function hideLoading(){
      const el = document.getElementById('loading');
      if(el) el.remove();
    }

    function askNext(){
      if(step < surveyFlow.length){
        showLoading();
        setTimeout(()=>{
          hideLoading();
          const q = surveyFlow[step];
          showBotMessage(`<strong>Question ${step+1} of 6</strong>\n\n${q.question}`);

          let html = "<div class='options'>";
          q.options.forEach(opt=>{
            const esc = opt.replace(/'/g, "\\'");
            html += `<button onclick="selectOption('${esc}')">${opt}</button>`;
          });
          html += "</div>";
          chat.innerHTML += html;
          chat.scrollTop = chat.scrollHeight;
        }, 700);
      } else {
        askForEmail();
      }
    }

    function selectOption(option){
      document.querySelectorAll(".options").forEach(el=>el.remove());
      showUserMessage(option);
      answers.push(option);
      step++;
      setTimeout(askNext, 250);
    }

    function askForEmail(){
      showBotMessage("ðŸ“© Last thing â€” what's the email you used to grab your Real Brick Roadâ„¢ booklet?");
      chat.innerHTML += `
        <input type="email" id="emailInput" placeholder="Enter your emailâ€¦"
               onkeydown="if(event.key==='Enter'){saveEmail();}">
      `;
      document.getElementById("emailInput").focus();
    }

    function saveEmail(){
      const email = document.getElementById("emailInput").value.trim();
      if(!email){
        showBotMessage("I'll need your email to lock your Legacy Code. ðŸ’›");
        return;
      }
      userEmail = email;
      showUserMessage(email);
      document.getElementById("emailInput").remove();
      submitSurvey();
    }

    function submitSurvey(){
      showLoading();
      fetch(BACKEND_URL, {
        method: "POST",
        headers: {"Content-Type":"application/json"},
        body: JSON.stringify({ email: userEmail, answers })
      })
      .then(res=>res.json())
      .then(data=>{
        hideLoading();
        if(data.status === "success" && data.legacy_code){
          // SUCCESS - Show Legacy Code and completion message
          showBotMessage(`ðŸŽ¯ **BOOM!** Your Legacy Code is locked in:\n\nðŸ” **${data.legacy_code}**\n\nâœ… Your answers have been saved and will sync to your profile shortly.\n\nðŸš€ Keep an eye on your email â€” I'll be sending you your personalized 90-day blueprint soon!\n\nLet's build something legendary together! ðŸ§±âš¡`);
        } else if(data.error) {
          // ERROR from backend
          showBotMessage(`âš ï¸ Oops, hit a snag: ${data.error}\n\nPlease refresh and try again.`);
        } else {
          // Unexpected response
          showBotMessage("âš ï¸ Something glitched â€” refresh and try again.");
        }
      })
      .catch(err=>{
        console.error(err);
        hideLoading();
        showBotMessage("ðŸš¨ Server issue. Refresh and try again.");
      });
    }

    window.selectOption = selectOption;
    window.saveEmail = saveEmail;

    window.onload = function(){
      showBotMessage("ðŸ‘‹ Alright legend â€” I'm **ANGUSâ„¢**.\nLet's lock in your first bricks so I can map your path with precision. ðŸ§±âš¡");
      setTimeout(()=> askNext(), 1100);
    };
  </script>
</body>
</html>
