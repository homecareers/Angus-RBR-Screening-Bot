<!DOCTYPE html>
<html>
<head>
  <title>ANGUSâ„¢ â€” Legacy Code Screening</title>
  <style>
    body {
      font-family: 'Inter', Arial, sans-serif;
      background: #050608;
      color: #f5f5f5;
      margin: 0;
      padding: 20px;
      min-height: 100vh;
    }
    .chat-box {
      max-width: 680px;
      margin: 40px auto;
      background: #0f0f0f;
      padding: 30px;
      border-radius: 18px;
      box-shadow: 0 24px 60px rgba(0,0,0,0.85);
      border: 1px solid #222;
    }
    .message {
      margin: 16px 0;
      line-height: 1.6;
      animation: fadeIn 0.45s ease-in;
    }
    .bot {
      color: #f5f5f5;
    }
    .user {
      color: #D4A72C;
      text-align: right;
      font-weight: 600;
    }
    .bot strong {
      color: #D4A72C;
    }
    .options button {
      display: block;
      width: 100%;
      padding: 12px 16px;
      background: #111;
      color: #f5f5f5;
      border: 1px solid #D4A72C;
      border-radius: 10px;
      margin: 10px 0;
      text-align: left;
      cursor: pointer;
      transition: all 0.22s ease;
      font-size: 15px;
    }
    .options button:hover {
      background: #D4A72C;
      color: #050608;
      transform: translateY(-2px);
      box-shadow: 0 0 18px rgba(212,167,44,0.45);
    }
    input, textarea {
      width: 100%;
      padding: 14px;
      margin-top: 16px;
      border-radius: 10px;
      background: #111;
      border: 2px solid #333;
      color: #f5f5f5;
      font-size: 16px;
      box-sizing: border-box;
      font-family: 'Inter', Arial, sans-serif;
    }
    textarea {
      min-height: 100px;
      resize: vertical;
    }
    input:focus, textarea:focus {
      outline: none;
      border-color: #D4A72C;
      box-shadow: 0 0 10px rgba(212,167,44,0.35);
    }
    .submit-btn {
      background: #D4A72C;
      color: #050608;
      padding: 12px 24px;
      border: none;
      border-radius: 10px;
      margin-top: 10px;
      cursor: pointer;
      font-size: 16px;
      font-weight: 600;
      transition: all 0.22s ease;
    }
    .submit-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 0 18px rgba(212,167,44,0.45);
    }
    .loading {
      color: #D4A72C;
      font-style: italic;
    }
    .loading::after {
      content: "...";
      animation: dots 1.5s infinite;
    }
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(12px); }
      to   { opacity: 1; transform: translateY(0); }
    }
    @keyframes dots {
      0%   { content: ""; }
      33%  { content: "."; }
      66%  { content: ".."; }
      100% { content: "..."; }
    }
    @media(max-width:600px) {
      .chat-box { padding: 22px; margin: 20px auto; }
    }
  </style>
</head>

<body>
  <div class="chat-box" id="chat"></div>

  <script>
    const chat = document.getElementById('chat');

    // âœ… UPDATED â€” Use relative URL for submit endpoint
    const BACKEND_URL = "/submit";

    // ----------------------------------------
    // NEW 6 screening questions
    // ----------------------------------------
    const surveyFlow = [
      {
        question: "ğŸ”¥ <strong>Q1:</strong> What's the REAL reason you're exploring a new path right now?",
        options: [
          "ğŸ’° Money pressure â€” I need breathing room",
          "ğŸ•Šï¸ I want more freedom + control",
          "ğŸŒªï¸ I'm craving a fresh start",
          "ğŸ˜ I'm not fulfilled where I am",
          "ğŸ—ï¸ I want to build something that actually lasts",
          "âš¡ Not sure â€” something in me just says 'it's time'"
        ]
      },
      {
        question: "ğŸ§­ <strong>Q2:</strong> Where are you in life/work as you step into this?",
        options: [
          "ğŸ‘” Working full-time",
          "ğŸ¡ Stay-at-home parent",
          "ğŸ”„ Between jobs / rebuilding",
          "ğŸ§ª Running a side hustle",
          "ğŸš€ Running my own business",
          "âœï¸ Other / I'll explain"
        ],
        customInputIndex: 5  // Last option triggers custom input for Q2
      },
      {
        question: "â³ <strong>Q3:</strong> How much weekly bandwidth can you commit to building your Legacy?",
        options: [
          "3â€“5 hrs",
          "5â€“10 hrs",
          "10â€“20 hrs",
          "20+ hrs",
          "ğŸ”¥ I'll find the time â€” this matters"
        ]
      },
      {
        question: "ğŸ§¨ <strong>Q4:</strong> When you've tried chasing big goals beforeâ€¦ what usually derailed you?",
        options: [
          "ğŸ§± No structure",
          "ğŸ§‘â€ğŸ« No mentor",
          "ğŸ§  Overthinking",
          "ğŸŒŠ Life chaos",
          "ğŸ˜¬ Confidence dips",
          "ğŸª I've never really pursued a big goal before"
        ]
      },
      {
        question: "ğŸ’ <strong>Q5:</strong> What style do you thrive in?",
        options: [
          "ğŸ—ºï¸ Clear structure",
          "âœ… Step-by-step",
          "ğŸŒ¿ Freedom/flexibility",
          "ğŸ¯ Accountability",
          "ğŸ¤ Community support",
          "âœï¸ Let me describe it"
        ]
        // NO customInputIndex for Q5 - regular selection only
      },
      {
        question: "âš¡ <strong>Q6:</strong> If I map out a personalized 90-day blueprint for youâ€¦ are you ready to follow it?",
        options: [
          "âœ… Yes â€” I'm ready now",
          "ğŸ‘ Yes â€” if the plan feels doable",
          "ğŸ¤” I want to be, but I need clarity first",
          "ğŸ§­ Not sure yet â€” guide me"
        ],
        customInputIndex: 3  // Last option triggers custom input for Q6
      }
    ];

    let answers = [];
    let step = 0;
    let userEmail = "";

    function showBotMessage(msg){
      chat.innerHTML += `<div class="message bot">${msg}</div>`;
      chat.scrollTop = chat.scrollHeight;
    }
    function showUserMessage(msg){
      chat.innerHTML += `<div class="message user">${msg}</div>`;
      chat.scrollTop = chat.scrollHeight;
    }
    function showLoading(){
      chat.innerHTML += `<div class="message loading" id="loading">ANGUS is thinking</div>`;
      chat.scrollTop = chat.scrollHeight;
    }
    function hideLoading(){
      const el = document.getElementById('loading');
      if(el) el.remove();
    }

    function askNext(){
      if(step < surveyFlow.length){
        showLoading();
        setTimeout(()=>{
          hideLoading();
          const q = surveyFlow[step];
          showBotMessage(`<strong>Question ${step+1} of 6</strong><br><br>${q.question}`);

          let html = "<div class='options'>";
          q.options.forEach((opt, index)=>{
            const esc = opt.replace(/'/g, "\\'");
            // Check if this option should trigger custom input (only for Q2 and Q6)
            if(q.customInputIndex !== undefined && index === q.customInputIndex) {
              html += `<button onclick="selectCustomOption('${esc}')">${opt}</button>`;
            } else {
              html += `<button onclick="selectOption('${esc}')">${opt}</button>`;
            }
          });
          html += "</div>";
          chat.innerHTML += html;
          chat.scrollTop = chat.scrollHeight;
        }, 800);
      } else {
        askForEmail();
      }
    }

    function selectOption(option){
      document.querySelectorAll(".options").forEach(el=>el.remove());
      showUserMessage(option);
      answers.push(option);
      step++;
      setTimeout(askNext, 300);
    }

    function selectCustomOption(option){
      document.querySelectorAll(".options").forEach(el=>el.remove());
      showUserMessage(option);
      
      // Show custom input field
      showBotMessage("Please tell me more:");
      chat.innerHTML += `
        <div id="customInputDiv">
          <textarea id="customInput" placeholder="Type your answer here..."></textarea>
          <button class="submit-btn" onclick="submitCustomAnswer()">Submit</button>
        </div>
      `;
      document.getElementById("customInput").focus();
      chat.scrollTop = chat.scrollHeight;
    }

    function submitCustomAnswer(){
      const customAnswer = document.getElementById("customInput").value.trim();
      if(!customAnswer){
        showBotMessage("Please provide your answer to continue.");
        return;
      }
      
      // Remove input div
      document.getElementById("customInputDiv").remove();
      
      // Show user's custom answer
      showUserMessage(customAnswer);
      
      // Store the custom answer
      answers.push(customAnswer);
      step++;
      setTimeout(askNext, 300);
    }

    function askForEmail(){
      showBotMessage("Last thing â€” what's the email you used to grab your Real Brick Roadâ„¢ booklet?");
      chat.innerHTML += `
        <input type="email" id="emailInput" placeholder="Enter your email..."
          onkeydown="if(event.key==='Enter'){saveEmail();}">
      `;
      document.getElementById("emailInput").focus();
    }

    function saveEmail(){
      const email = document.getElementById("emailInput").value.trim();
      if(!email){
        showBotMessage("I'll need your email for your results.");
        return;
      }
      userEmail = email;
      showUserMessage(email);
      document.getElementById("emailInput").remove();
      submitSurvey();
    }

    function submitSurvey(){
      showLoading();
      fetch(BACKEND_URL, {
        method: "POST",
        headers: {"Content-Type":"application/json"},
        body: JSON.stringify({email:userEmail, answers:answers})
      })
      .then(res=>res.json())
      .then(data=>{
        hideLoading();
        if(data.redirect_url){
          window.top.location.href = data.redirect_url;
        } else {
          showBotMessage("Something glitched â€” refresh and try again.");
        }
      })
      .catch(err=>{
        console.error(err);
        hideLoading();
        showBotMessage("Server issue. Refresh and try again.");
      });
    }

    window.selectOption = selectOption;
    window.selectCustomOption = selectCustomOption;
    window.submitCustomAnswer = submitCustomAnswer;
    window.saveEmail = saveEmail;

    window.onload = function(){
      showBotMessage("Alright legend â€” I'm ANGUSâ„¢. Let's lock in the intel so I can map your Legacy Code pathway with precision.");
      setTimeout(()=> askNext(), 1400);
    };
  </script>
</body>
</html>
