<!DOCTYPE html>
<html>
<head>
  <title>ANGUSâ„¢ Survey Bot â€” Elite Cinematic Edition</title>
  <style>
    body { 
      font-family: 'Inter', Arial, sans-serif; 
      background: #111; 
      color: #eee; 
      margin: 0; 
      padding: 20px; 
      min-height: 100vh;
    }
    .chat-box { 
      max-width: 600px; 
      margin: 50px auto; 
      background: #1a1a1a; 
      padding: 30px; 
      border-radius: 12px; 
      box-shadow: 0 4px 20px rgba(0,0,0,0.6);
    }
    .message { 
      margin: 15px 0; 
      line-height: 1.6;
      animation: fadeIn 0.5s ease-in;
    }
    .bot { color: #33E1FF; font-weight: 500; }
    .user { color: #00B4D8; text-align: right; font-weight: 500; }
    .options { margin: 20px 0; }
    .options button { 
      display: block; 
      margin: 8px 0; 
      width: 100%; 
      padding: 12px 16px; 
      border: 1px solid #00FFC8; 
      border-radius: 8px; 
      background: #1e1e1e; 
      color: #00FFC8; 
      cursor: pointer; 
      font-size: 14px;
      transition: all 0.25s ease;
      text-align: left;
    }
    .options button:hover {
      background: #33E1FF;
      color: #000;
      transform: translateY(-2px);
    }
    input {
      width: 100%;
      padding: 12px;
      margin-top: 15px;
      border: 2px solid #00FFC8;
      border-radius: 8px;
      background: #222;
      color: #fff;
      font-size: 16px;
    }
  </style>
</head>
<body>
  <div class="chat-box" id="chat"></div>

  <script>
    const surveyFlow = [
      { question: "When you picture your future, which one gets you fired up the most?",
        options:["ğŸŒ´ More time freedom","ğŸ’° Extra income","ğŸ”„ Career change","ğŸ¤ Community","âœï¸ Other"] },
      { question:"If building your future was a Netflix series, how many hours a week?",
        options:["3â€“5","5â€“10","10â€“15","15+"] },
      { question:"Every hero's got a storyline â€” which one is yours?",
        options:["âœ¨ Newbie","ğŸ˜… Tried before","ğŸ† Crushed it"] },
      { question:"If I dropped a simple plan today, when would you start?",
        options:["ğŸš€ Now","ğŸ“† 30 days","â³ 2â€“3 months","ğŸ‘€ Just exploring"] },
      { question:"On a 1â€“10 confidence scale?",
        options:["1","2","3","4","5","6","7","8","9","10"] },
      { question:"In a team setting, what lights you up?",
        options:["ğŸ¤ Pearl","ğŸ‰ Ruby","ğŸ“Š Sapphire","ğŸ’ Emerald"] }
    ];

    let answers = [];
    let step = 0;
    let userEmail = "";

    function showBot(msg){
      chat.innerHTML += `<div class="message bot">${msg}</div>`;
    }
    function showUser(msg){
      chat.innerHTML += `<div class="message user">${msg}</div>`;
    }
    function askNext(){
      if(step < surveyFlow.length){
        const q = surveyFlow[step];
        showBot(`<strong>Question ${step+1} of 6:</strong><br>${q.question}`);
        let html = "<div class='options'>";
        q.options.forEach(opt=>{
          html += `<button onclick="selectOption('${opt.replace(/'/g,'\\\'')}')">${opt}</button>`;
        });
        html += "</div>";
        chat.innerHTML += html;
      } else askForEmail();
    }
    function selectOption(opt){
      document.querySelectorAll('.options').forEach(x=>x.remove());
      showUser(opt);
      answers.push(opt);
      step++;
      askNext();
    }
    function askForEmail(){
      showBot("Last step â€” what's the email you used for your RBR booklet?");
      chat.innerHTML += `<input id="emailInput" type="email" placeholder="Enter your email" onkeydown="if(event.key==='Enter')saveEmail()">`;
      document.getElementById("emailInput").focus();
    }
    function saveEmail(){
      const email = emailInput.value.trim();
      userEmail = email;
      showUser(email);
      emailInput.remove();
      submitSurvey();
    }

    // â­ FINAL WORKING SUBMIT SYSTEM â­
    function submitSurvey(){
      const payload = { email:userEmail, answers:answers };

      fetch("https://angus-rbr-survey-booking-bot-production.up.railway.app/submit",{
        method:"POST",
        headers:{"Content-Type":"application/json"},
        body:JSON.stringify(payload)
      })
      .then(res=>res.json())
      .then(data=>{
        if(data.redirect_url){
          window.top.location.href = data.redirect_url;
        } else {
          showBot("âš ï¸ Something went wrong. Try again.");
        }
      })
      .catch(err=>{
        console.log(err);
        showBot("âš ï¸ Issue sending answers. Try again.");
      });
    }

    showBot("I'm ANGUSâ„¢. Ready?");
    askNext();
  </script>
</body>
</html>
