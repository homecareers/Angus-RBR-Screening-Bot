<!DOCTYPE html>
<html>
<head>
  <title>ANGUS™ — Legacy Code Screening</title>
  <style>
    body {
      font-family: 'Inter', Arial, sans-serif;
      background: #050608;
      color: #f5f5f5;
      margin: 0;
      padding: 20px;
      min-height: 100vh;
    }

    .chat-box {
      max-width: 680px;
      margin: 40px auto;
      background: #0f0f0f;
      padding: 30px;
      border-radius: 18px;
      box-shadow: 0 24px 60px rgba(0,0,0,0.85);
      border: 1px solid #222;
    }

    .message {
      margin: 16px 0;
      line-height: 1.6;
      animation: fadeIn 0.45s ease-in;
    }

    .bot {
      color: #f5f5f5;
    }

    .user {
      color: #D4A72C;
      text-align: right;
      font-weight: 600;
    }

    .bot strong {
      color: #D4A72C;
    }

    .options button {
      display: block;
      width: 100%;
      padding: 12px 16px;
      background: #111;
      color: #f5f5f5;
      border: 1px solid #D4A72C;
      border-radius: 10px;
      margin: 10px 0;
      text-align: left;
      cursor: pointer;
      transition: all 0.22s ease;
      font-size: 15px;
    }

    .options button:hover {
      background: #D4A72C;
      color: #050608;
      transform: translateY(-2px);
      box-shadow: 0 0 18px rgba(212,167,44,0.45);
    }

    input {
      width: 100%;
      padding: 14px;
      margin-top: 16px;
      border-radius: 10px;
      background: #111;
      border: 2px solid #333;
      color: #f5f5f5;
      font-size: 16px;
      box-sizing: border-box;
    }

    input:focus {
      outline: none;
      border-color: #D4A72C;
      box-shadow: 0 0 10px rgba(212,167,44,0.35);
    }

    .loading {
      color: #D4A72C;
      font-style: italic;
    }

    .loading::after {
      content: "...";
      animation: dots 1.5s infinite;
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(12px); }
      to { opacity: 1; transform: translateY(0); }
    }

    @keyframes dots {
      0% { content: ""; }
      33% { content: "."; }
      66% { content: ".."; }
      100% { content: "..."; }
    }

    @media(max-width:600px) {
      .chat-box { padding: 22px; margin: 20px auto; }
    }
  </style>
</head>

<body>
  <div class="chat-box" id="chat"></div>

  <script>
    const chat = document.getElementById('chat');
    const BACKEND_URL = "https://YOUR_BACKEND_URL/submit"; // replace with your Railway URL

    // ----------------------------------------
    // The original 6 screening questions
    // ----------------------------------------
    const surveyFlow = [
      {
        question: "When you picture your future, which one gets you fired up the most?",
        options: [
          "More time freedom for adventures",
          "Extra income (bye-bye money stress)",
          "Total career change (fresh chapter)",
          "Belonging to a mission-driven community",
          "Other"
        ]
      },
      {
        question: "If building your future was a Netflix series... how many hours a week would you binge it?",
        options: [
          "3–5 hours (side hustle pilot)",
          "5–10 hours (mini-series)",
          "10–15 hours (serious arc)",
          "15+ hours (full box set, I'm all in)"
        ]
      },
      {
        question: "Every hero's got a storyline — which best describes yours so far?",
        options: [
          "Total newbie (fresh chapter)",
          "Tried before, didn’t work out",
          "Tried before and crushed it"
        ]
      },
      {
        question: "If I dropped a simple game plan in your lap today — when would you press play?",
        options: [
          "Right now",
          "Within 30 days",
          "2–3 months out",
          "Just exploring for now"
        ]
      },
      {
        question: "On a 1–10 confidence scale — where are you right now?",
        options: ["1","2","3","4","5","6","7","8","9","10"]
      },
      {
        question: "In a team setting, what lights you up the most?",
        options: [
          "Connecting & building relationships (Pearl)",
          "Recognition & being celebrated (Ruby)",
          "Clear systems & structure (Sapphire)",
          "Hitting goals & building wealth (Emerald)"
        ]
      }
    ];

    let answers = [];
    let step = 0;
    let userEmail = "";

    function showBotMessage(msg){
      chat.innerHTML += `<div class="message bot">${msg}</div>`;
      chat.scrollTop = chat.scrollHeight;
    }

    function showUserMessage(msg){
      chat.innerHTML += `<div class="message user">${msg}</div>`;
      chat.scrollTop = chat.scrollHeight;
    }

    function showLoading(){
      chat.innerHTML += `<div class="message loading" id="loading">ANGUS is thinking</div>`;
    }

    function hideLoading(){
      const el = document.getElementById('loading');
      if(el) el.remove();
    }

    function askNext(){
      if(step < surveyFlow.length){
        showLoading();
        setTimeout(()=>{
          hideLoading();
          const q = surveyFlow[step];
          showBotMessage(`<strong>Question ${step+1} of 6</strong><br><br>${q.question}`);

          let html = "<div class='options'>";
          q.options.forEach(opt=>{
            const esc = opt.replace(/'/g, "\\'");
            html += `<button onclick="selectOption('${esc}')">${opt}</button>`;
          });
          html += "</div>";
          chat.innerHTML += html;

        },800);
      } else {
        askForEmail();
      }
    }

    function selectOption(option){
      document.querySelectorAll(".options").forEach(el=>el.remove());
      showUserMessage(option);
      answers.push(option);
      step++;
      setTimeout(askNext,300);
    }

    function askForEmail(){
      showBotMessage("Last thing — what's the email you used to grab your Real Brick Road™ booklet?");
      chat.innerHTML += `
        <input type="email" id="emailInput" placeholder="Enter your email..."
               onkeydown="if(event.key==='Enter'){saveEmail();}">
      `;
      document.getElementById("emailInput").focus();
    }

    function saveEmail(){
      const email = document.getElementById("emailInput").value.trim();
      if(!email){ showBotMessage("I’ll need your email for your results."); return; }
      userEmail = email;
      showUserMessage(email);
      document.getElementById("emailInput").remove();
      submitSurvey();
    }

    function submitSurvey(){
      showLoading();

      fetch(BACKEND_URL, {
        method: "POST",
        headers: {"Content-Type":"application/json"},
        body: JSON.stringify({email:userEmail, answers:answers})
      })
      .then(res=>res.json())
      .then(data=>{
        hideLoading();
        if(data.redirect_url){
          window.top.location.href = data.redirect_url;
        } else {
          showBotMessage("Something glitched — refresh and try again.");
        }
      })
      .catch(err=>{
        console.error(err);
        hideLoading();
        showBotMessage("Server issue. Refresh and try again.");
      });
    }

    window.selectOption = selectOption;

    window.onload = function(){
      showBotMessage("Alright legend — I'm ANGUS™. Let’s lock in the intel so I can map your Legacy Code pathway with precision.");
      setTimeout(()=> askNext(), 1400);
    };
  </script>
</body>
</html>
